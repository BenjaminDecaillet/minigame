<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matthew's Gift</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a;
            --card: #1e313b;
            --accent: #f59e0b;
            --text: #f1f5f9;
            --wood: #92400e;
            --bug: #22c55e;
            --hammer: #dc2626;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        #app {
            width: 95%;
            max-width: 600px;
        }

        .card {
            background: var(--card);
            padding: 2.5rem;
            border-radius: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            animation: fadeIn 0.5s ease-out;
        }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3.5rem;
            margin-bottom: 0.5rem;
            color: var(--accent);
        }

        .score-box {
            display: flex;
            justify-content: space-around;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            font-weight: bold;
        }

        p {
            font-size: 1.1rem;
            color: #cbd5e1;
            margin-bottom: 2rem;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            padding: 1.2rem;
            border: none;
            border-radius: 1rem;
            background: #334155;
            color: white;
            cursor: pointer;
            transition: 0.3s;
            font-weight: 600;
            font-size: 1rem;
        }

        button:hover {
            background: var(--accent);
            color: var(--bg);
            transform: scale(1.02);
        }

        #game-zone {
            background: radial-gradient(circle, #1e293b 0%, #020617 100%);
            border-radius: 1.5rem;
            position: relative;
            height: 400px;
            overflow: hidden;
            margin-bottom: 1.5rem;
            border: 3px solid var(--accent);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.8);
        }

        .game-ui {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
            pointer-events: none;
        }

        .progress-container {
            width: 100px;
            height: 10px;
            background: #334155;
            border-radius: 5px;
            overflow: hidden;
            border: 1px solid var(--accent);
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: var(--accent);
            transition: width 0.3s ease;
        }

        .lapsus {
            position: absolute;
            padding: 12px 20px;
            background: white;
            color: var(--bg);
            border-radius: 50px;
            cursor: pointer;
            font-weight: 800;
            font-size: 0.9rem;
            white-space: nowrap;
            user-select: none;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s, opacity 0.3s;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .stain {
            position: absolute;
            width: 40px;
            height: 40px;
            background: #991b1b;
            border-radius: 50%;
            cursor: pointer;
            filter: blur(2px);
            transition: transform 0.2s;
        }

        .cat-bonus {
            position: absolute;
            font-size: 2.5rem;
            cursor: pointer;
            z-index: 5;
            user-select: none;
        }

        .game-over-overlay {
            position: absolute;
            inset: 0;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            gap: 15px;
            animation: fadeIn 0.3s ease;
        }

        .floating-icon {
            position: absolute;
            font-size: 2.5rem;
            cursor: pointer;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.5));
            user-select: none;
            transition: transform 0.1s;
        }

        @keyframes popIn {
            from {
                transform: scale(0);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes shake {
            0% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }

            100% {
                transform: translateX(0);
            }
        }

        .shake {
            animation: shake 0.2s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <audio id="duck-sound" src="https://www.myinstants.com/media/sounds/quack.mp3"></audio>
    <audio id="cartoon-hammer" src="https://www.myinstants.com/media/sounds/cartoon-hammer.mp3"></audio>
    <audio id="aw-sound" src="https://www.myinstants.com/media/sounds/awwsoundheh.mp3"></audio>
    <audio id="rizz-sound" src="https://www.myinstants.com/media/sounds/rizz-sound-effect.mp3"></audio>
    <audio id="fart-sound" src="https://www.myinstants.com/media/sounds/dry-fart.mp3"></audio>

    <div id="app"></div>

    <script>
        const app = document.getElementById('app');
        const cartoonHammerSound = document.getElementById('cartoon-hammer');
        const awSound = document.getElementById('aw-sound');
        const rizzSound = document.getElementById('rizz-sound');
        const fartSound = document.getElementById('fart-sound');

        let state = {
            stepIndex: 0,
            scores: { wood: 0, bug: 0, hammer: 0 }
        };

        const story = [
            {
                title: "Matthew's Gift Quest",
                text: "Bienvenue Matthew! Pour trouver ton cadeau, tu devras relever des d√©fis et faire des choix. Pr√™t √† commencer¬†?",
                options: [{ text: "D√©marrer", score: { fart: 1 }, next: true }]
            },
            {
                title: "Les bases du bricolage",
                text: "Tu as besoin d'accrocher un cadre au mur. Que fais-tu¬†?",
                options: [
                    { text: "J'arr√™te tout et j'appelle mon beau-fr√®re pr√©f√©r√©! Lui il saura quoi faire.", score: { bug: 1 }, next: true },
                    { text: "Je prends mon fid√®le ami √† t√™te dure et je m'y mets.", score: { hammer: 1 }, next: true },
                    { text: "Je sors la perceuse, les bouts de lambourdes qu'il me reste, la scie circulaire, une √©chelle, un casque de soudure,.... et je bois une bi√®re!", score: { wood: 1 }, next: true }
                ]
            },
            {
                title: "JEU : Wood Hunter",
                text: "CONSIGNE : R√©cup√®re le bois qui tombe du ciel !",
                type: 'game',
                gameType: 'woodcatch',
                next: true
            },
            {
                title: "Tes reflexes de bricoleur pro",
                text: "Tu dois enfiler des clous dans un trou de 2mm. Combien de doigts vas-tu taper avant de r√©ussir ?",
                options: [
                    { text: "Aucun je suis un pro ", score: { bug: -1 }, next: true },
                    { text: "Vous ne saurez jamais le chiffre ! üöÄ", score: { wood: 1 }, next: true },
                    { text: "Enfiler des quoi ?", score: { hammer: 1 }, next: true }
                ]
            },
            {
                title: "JEU : Reflexe du bricoleur pro",
                text: "CONSIGNE : Des vers tentent de s'attaquer √† ton pr√©cieux bois √©crase les avant qu'il soit pourri !",
                type: 'game',
                gameType: 'bugwhack',
                next: true
            },
            {
                title: "Et les protections dans tout √ßa?",
                text: "Tu bricoles d'accord, mais portes tu les protections n√©cessaires ?",
                options: [
                    { text: "Evidemment! Tu sais dans mon dernier job j'√©tais charg√© de la s√©curit√© de toute la commune de Conthey !", score: { hammer: 1 }, next: true },
                    { text: "Le bon bricoleur il prend son marteau et il frappe. Le mauvais bricoleur il prend son marteau et il frappe, mais c'est pas pareil !", score: { bug: 1 }, next: true },
                    { text: "Les protections c'est pour les faibles !", score: { wood: 1 }, next: true }
                ]
            },
            {
                title: "JEU : Sauve ton pied !",
                text: "CONSIGNE : Clique sur le marteau pour le maintenir en √©quilibre et en l'air et √©viter qu'il n'√©crase ton pied !",
                type: 'game',
                gameType: 'hammerclick',
                next: true
            },
            {
                title: "L'Analyse Finale",
                text: "Benjamin, le parcours est termin√©. Ton destin est scell√©.",
                options: [{ text: "Voir ton cadeau", next: true }]
            }
        ];

        function render() {
            if (state.stepIndex >= story.length) return renderResult();
            const node = story[state.stepIndex];

            app.innerHTML = `
            <div class="card">
                <div class="score-box">
                    <span style="color:var(--wood)">ü™µ Wood: ${state.scores.wood}</span>
                    <span style="color:var(--bug)">üêõ Bug Hunter: ${state.scores.bug}</span>
                    <span style="color:var(--hammer)">üî® Safety: ${state.scores.hammer}</span>
                </div>
                <h1>${node.title}</h1>
                <p>${node.text}</p>
                <div class="options">
                    ${node.type === 'game' ? `<button onclick="launchGame('${node.gameType}')">JOUER</button>` : renderOptions(node.options)}
                </div>
            </div>
        `;
        }

        function renderOptions(options) {
            return options.map(opt => `<button onclick="handleChoice(${JSON.stringify(opt.score || null).replace(/"/g, '&quot;')})">${opt.text}</button>`).join('');
        }

        window.handleChoice = (score) => {
            if (score) {
                if (score.wood) rizzSound.play();
                if (score.bug) awSound.play();
                if (score.hammer) cartoonHammerSound.play();
                for (let key in score) state.scores[key] += score[key];
            }
            state.stepIndex++;
            render();
        };

        function showEndGameMenu(msg, points, type) {
            const zone = document.getElementById('game-zone');
            const overlay = document.createElement('div');
            overlay.className = 'game-over-overlay';
            overlay.innerHTML = `
                <h2 style="color:var(--accent); margin:0;">${msg}</h2>
                <div style="display:flex; gap:10px;">
                    <button onclick="launchGame('${type}')" style="background:#475569; padding: 0.8rem 1.2rem;">R√âESSAYER</button>
                    <button onclick="handleChoice(${JSON.stringify(points).replace(/"/g, '&quot;')})" style="background:var(--accent); color:var(--bg); padding: 0.8rem 1.2rem;">CONTINUER</button>
                </div>
            `;
            zone.appendChild(overlay);
        }

        window.launchGame = (type) => {
            const card = document.querySelector('.card');
            card.innerHTML = `
                <div class="game-ui">
                    <div id="game-msg" style="color:var(--accent); font-weight:bold;">SCORE: <span id="g-score">0</span></div>
                    <div class="progress-container"><div id="p-bar" class="progress-bar"></div></div>
                </div>
                <div id="game-zone"></div>
            `;

            const zone = document.getElementById('game-zone');
            const pBar = document.getElementById('p-bar');
            const gScore = document.getElementById('g-score');

            const updateProgress = (current, total) => {
                pBar.style.width = (current / total * 100) + '%';
            };

            if (type === 'woodcatch') {
                zone.innerHTML += `<div id="basket" style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%); font-size:3rem; transition: left 0.1s; user-select:none;">üß∫</div>`;
                const basket = document.getElementById('basket');
                let basketPos = 50; // percentage
                let caught = 0;
                let missed = 0;
                const goal = 15;
                const maxMissed = 5;

                // Mouse control
                zone.onmousemove = (e) => {
                    const rect = zone.getBoundingClientRect();
                    basketPos = ((e.clientX - rect.left) / rect.width) * 100;
                    basketPos = Math.max(5, Math.min(95, basketPos));
                    basket.style.left = basketPos + '%';
                };

                const spawnWood = () => {
                    if (!document.getElementById('game-zone')) return;
                    const wood = document.createElement('div');
                    wood.innerHTML = 'ü™µ';
                    wood.style.cssText = `position:absolute; left:${Math.random() * 90}%; top:-50px; font-size:2rem; user-select:none;`;
                    zone.appendChild(wood);

                    let woodY = -50;
                    let woodX = parseFloat(wood.style.left);
                    const fallInterval = setInterval(() => {
                        woodY += 5;
                        wood.style.top = woodY + 'px';

                        // Check collision with basket
                        if (woodY > zone.offsetHeight - 80 && woodY < zone.offsetHeight - 40) {
                            if (Math.abs(woodX - basketPos) < 8) {
                                clearInterval(fallInterval);
                                wood.remove();
                                caught++;
                                rizzSound.play();
                                gScore.innerText = caught;
                                updateProgress(caught, goal);

                                if (caught >= goal) {
                                    zone.onmousemove = null;
                                    showEndGameMenu("ALL WOOD CAUGHT! ü™µ", { wood: 2 }, type);
                                }
                            }
                        }

                        // Missed the basket
                        if (woodY > zone.offsetHeight) {
                            clearInterval(fallInterval);
                            wood.remove();
                            missed++;
                            fartSound.play();
                            if (missed >= maxMissed) {
                                zone.onmousemove = null;
                                showEndGameMenu("TOO MUCH WASTED WOOD!", { wood: 0 }, type);
                            }
                        }
                    }, 30);
                };

                const spawnLoop = setInterval(() => {
                    if (!document.getElementById('game-zone')) clearInterval(spawnLoop);
                    spawnWood();
                }, 800);
            }

            if (type === 'bugwhack') {
                zone.innerHTML += `<div style="position:absolute; inset:0; background:url('data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22><rect fill=%22%23654321%22 width=%22100%22 height=%22100%22/></svg>') center/80% no-repeat;"></div>`;
                let whacked = 0;
                const goal = 20;
                let spawnRate = 800;

                const spawnBug = () => {
                    if (!document.getElementById('game-zone')) return;
                    const bug = document.createElement('div');
                    bug.innerHTML = 'üêõ';
                    bug.style.cssText = `position:absolute; left:${Math.random() * 85}%; top:${Math.random() * 85}%; font-size:2.5rem; cursor:pointer; user-select:none; animation: popIn 0.3s;`;
                    zone.appendChild(bug);

                    const bugLife = setTimeout(() => {
                        if (bug.parentNode) {
                            bug.remove();
                        }
                    }, 1500 - (whacked * 30)); // Bugs disappear faster as you progress

                    bug.onclick = () => {
                        clearTimeout(bugLife);
                        bug.innerHTML = 'üí•';
                        awSound.play();
                        whacked++;
                        gScore.innerText = whacked;
                        updateProgress(whacked, goal);
                        setTimeout(() => bug.remove(), 200);

                        if (whacked >= goal) {
                            clearInterval(gameLoop);
                            showEndGameMenu("ALL BUGS EXTERMINATED! üî®", { bug: 2 }, type);
                        }

                        // Increase difficulty
                        if (whacked % 5 === 0 && spawnRate > 300) {
                            spawnRate -= 100;
                        }
                    };
                };

                let gameLoop = setInterval(() => {
                    spawnBug();
                }, spawnRate);

                // Spawn initial bugs
                for (let i = 0; i < 3; i++) {
                    setTimeout(spawnBug, i * 300);
                }
            }

            if (type === 'hammerclick') {
                zone.innerHTML += `
                    <div id="foot" style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%); font-size:4rem; user-select:none;">ü¶∂</div>
                    <div id="hammer-fall" style="position:absolute; left:50%; top:50px; transform:translateX(-50%); font-size:3.5rem; cursor:pointer; user-select:none; transition: top 0.05s linear;">üî®</div>
                    <div style="position:absolute; top:10px; left:50%; transform:translateX(-50%); color:var(--accent); font-weight:bold; font-size:0.9rem;">CLICK TO LIFT!</div>
                `;

                const hammer = document.getElementById('hammer-fall');
                let hammerY = 50;
                let fallSpeed = 1;
                let clicks = 0;
                const clickGoal = 50;

                const gameLoop = setInterval(() => {
                    if (!document.getElementById('game-zone')) return clearInterval(gameLoop);

                    fallSpeed += 0.05;
                    hammerY += fallSpeed;
                    hammer.style.top = hammerY + 'px';

                    gScore.innerText = clicks;
                    updateProgress(clicks, clickGoal);

                    // Victory - hammer reaches top
                    if (hammerY < -20) {
                        clearInterval(gameLoop);
                        cartoonHammerSound.play();
                        showEndGameMenu("HAMMER SAVED! YOUR TOES ARE SAFE! üéâ", { hammer: 2 }, type);
                    }

                    // Defeat - hammer hits foot
                    if (hammerY > 280) {
                        clearInterval(gameLoop);
                        fartSound.play();
                        showEndGameMenu("OUCH! THAT'S GONNA HURT! ü§ï", { hammer: 0 }, type);
                    }
                }, 30);

                hammer.onclick = () => {
                    hammerY -= 25;
                    clicks++;
                    rizzSound.play();

                    if (clicks >= clickGoal && hammerY > 0) {
                        clearInterval(gameLoop);
                        cartoonHammerSound.play();
                        showEndGameMenu("HAMMER MASTER! üî®", { hammer: 2 }, type);
                    }
                };
            }



        };


        function renderResult() {
            const s = state.scores;
            let title, gift;
            if (s.wood > s.bug && s.wood > s.hammer) {
                title = "THE MASTER CRAFTSMAN ü™µ"; gift = "A professional workshop organizer... because we know you need it!";
            } else if (s.hammer > s.bug) {
                title = "SAFETY CHAMPION üî®"; gift = "A deluxe first-aid kit for all those 'minor' workshop accidents!";
            } else {
                title = "THE EXTERMINATOR üêõ"; gift = "A year's supply of bug spray for your lumber collection!";
            }
            app.innerHTML = `<div class="card"><h1>${title}</h1><p>Wood ${s.wood} | Bug Hunter ${s.bug} | Safety ${s.hammer}</p><button onclick="alert('Your gift: ' + '${gift}')">Open My Gift!</button></div>`;
        }

        render();
    </script>
</body>

</html>